(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{568:function(t,e,s){"use strict";s.r(e);var a=s(12),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("hr"),t._v(" "),s("h1",{attrs:{id:"闭包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#闭包"}},[t._v("#")]),t._v(" 闭包")]),t._v(" "),s("p",[t._v("闭包按照书上的定义是"),s("code",[t._v("能够访问其他作用域中变量的函数")]),t._v("。我理解的是函数内部又嵌套了函数，内部函数保存了外部作用域的引用。来看一个经典的🌰：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("for(var i=0; i<5; i++) {\n    setTimeout(() => {\n        console.log(i);\n    }, 500)\n}\n")])])]),s("p",[t._v("上面的代码运行的结果会是什么？答案是5个5。")]),t._v(" "),s("p",[t._v("上面这段代码中存在的有两个作用域，一个是全局作用域，另一个是箭头函数的函数作用域。由于"),s("code",[t._v("setTimeout")]),t._v("是异步的，所以等到for循环完毕，即i=5的时候开始执行，这个时候在箭头函数里面找不到变量i，就会向上层作用域，即全局作用域去找，这个时候i已经循环完毕，值是5，所以会输出5次5。")]),t._v(" "),s("p",[t._v("那么有什么办法能让上面这段代码正常输出0-4呢？")]),t._v(" "),s("ul",[s("li",[s("ol",[s("li",[t._v("使用let声明")])])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("for(let i=0; i<5; i++) {\n    setTimeout(() => {\n        console.log(i);\n    }, 500)\n}\n")])])]),s("p",[t._v("使用let声明的时候每次相当于多生成了一个块级作用域，每次循环的时候这个块级作用域都存在，相当于下面的代码：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("{\n    let i = 0;\n    setTimeout(() => {\n        console.log(i);\n    }, 500);\n}\n{\n    let i = 1;\n    setTimeout(() => {\n        console.log(i);\n    }, 500);\n}\n...\n{\n    let i = 4;\n    setTimeout(() => {\n        console.log(i);\n    }, 500);\n}\n")])])]),s("p",[t._v("每次箭头函数执行的时候，相当于保存了初始化时外部块级作用域的引用，然后就会在块级作用域中找到正确的i变量。")]),t._v(" "),s("ul",[s("li",[s("ol",{attrs:{start:"2"}},[s("li",[t._v("利用"),s("code",[t._v("setTimeout")]),t._v("函数的第三个参数，在每次循环箭头函数初始化的时候将变量i传进去，相当于把每个变量i保存在了箭头函数的函数作用域中。")])])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("for(var i=0; i<5; i++) {\n    setTimeout((j) => {\n        console.log(j);\n    }, 500, i)\n}\n")])])]),s("ul",[s("li",[s("ol",{attrs:{start:"3"}},[s("li",[t._v("通过立即执行函数，原理与2相似，通过一个立即执行函数将每次循环的i保存在了该函数作用域中，而内部的箭头函数又保存了外部这个函数作用域的引用，每次箭头函数执行的时候都会到上层的函数作用域中找到这个i。")])])])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("for(var i=0; i<5; i++) {\n    (function(j){\n        setTimeout(() => {\n            console.log(j);\n        }, 500)\n    })(i)\n}\n")])])]),s("h2",{attrs:{id:"思考-为什么要设计闭包-闭包存在的意义是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#思考-为什么要设计闭包-闭包存在的意义是什么"}},[t._v("#")]),t._v(" 思考：为什么要设计闭包，闭包存在的意义是什么？")])])}),[],!1,null,null,null);e.default=n.exports}}]);